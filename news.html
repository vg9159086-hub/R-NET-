<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>R-net News</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:#0f0f0f;
  color:white;
}
header{
  background:#111;
  padding:10px;
  text-align:center;
}
.logo{height:55px;}
nav button{
  background:#ff0055;
  color:white;
  border:none;
  padding:8px 14px;
  margin:5px;
  border-radius:6px;
  cursor:pointer;
}
#loginBox, #newsForm{
  margin:20px auto;
  background:#181818;
  padding:20px;
  border-radius:12px;
  max-width:500px;
}
#loginBox input, #newsForm input, #newsForm textarea, #newsForm select{
  width:100%;
  padding:8px;
  margin:5px 0;
  border-radius:6px;
  border:none;
}
#newsForm textarea{height:100px;}
button{
  background:#ff0055;
  color:white;
  border:none;
  padding:10px 20px;
  margin-top:10px;
  border-radius:6px;
  cursor:pointer;
}
#mural{
  display:flex;
  flex-wrap:wrap;
  justify-content:center;
  padding:20px;
}
.postIt{
  width:250px;
  min-height:200px;
  margin:10px;
  padding:15px;
  border-radius:12px;
  color:black;
  position:relative;
  box-shadow:0 4px 10px rgba(0,0,0,0.5);
  font-family:Arial, sans-serif;
}
.postIt button{
  position:absolute;
  top:5px;
  right:5px;
  background:red;
  padding:5px 8px;
  font-size:12px;
}
</style>
</head>
<body>

<header>
  <img src="logo.png" class="logo">
  <h1>R-net News</h1>
</header>

<!-- LOGIN -->
<div id="loginBox">
  <h3>Login Admin (opcional)</h3>
  <input type="text" id="adminUID" placeholder="Seu UID">
  <button onclick="loginAdmin()">Entrar</button>
  <p>Se você não for admin, clique em "Continuar como visitante" para acessar o mural.</p>
  <button onclick="continueAsVisitor()">Continuar como visitante</button>
</div>

<!-- FORMULÁRIO DE NOTÍCIA -->
<div id="newsForm" class="hidden">
  <h3>Nova Notícia</h3>
  <input type="text" id="newsTitle" placeholder="Nome da notícia">
  <textarea id="newsContent" placeholder="Escreva sua notícia..."></textarea>
  <select id="newsColor">
    <option value="yellow">Amarelo</option>
    <option value="pink">Rosa</option>
    <option value="lightgreen">Verde</option>
    <option value="orange">Laranja</option>
  </select>
  <button onclick="postNews()">Postar</button>
</div>

<!-- MURAL -->
<div id="mural"></div>

<script>
// CONFIG FIREBASE
const firebaseConfig = {
  apiKey: "AIzaSyCUFift2BuvD433AYTBVNGCNli2PtBMalo",
  authDomain: "rnetnews-273fc.firebaseapp.com",
  projectId: "rnetnews-273fc",
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// UID do admin
const ADMIN_UID = "jy7EFx66yFYPVEi5XZaSVYcyWrw2";
let isAdmin = false;

// LOGIN ADMIN
function loginAdmin(){
  const inputUID = document.getElementById("adminUID").value.trim();
  if(inputUID === ADMIN_UID){
    isAdmin = true;
    document.getElementById("loginBox").classList.add("hidden");
    document.getElementById("newsForm").classList.remove("hidden");
    alert("Bem-vindo admin!");
  } else {
    alert("UID incorreto. Você será visitante.");
    continueAsVisitor();
  }
}

// VISITANTE
function continueAsVisitor(){
  isAdmin = false;
  document.getElementById("loginBox").classList.add("hidden");
  document.getElementById("newsForm").classList.add("hidden");
}

// POSTAR NOTÍCIA
async function postNews(){
  const title = document.getElementById("newsTitle").value.trim();
  const content = document.getElementById("newsContent").value.trim();
  const color = document.getElementById("newsColor").value;

  if(!title || !content){
    alert("Preencha título e conteúdo!");
    return;
  }

  await db.collection("news").add({
    title: title,
    content: content,
    color: color,
    uid: ADMIN_UID,
    date: new Date().toLocaleDateString(),
    time: new Date().toLocaleTimeString(),
    createdAt: firebase.firestore.FieldValue.serverTimestamp()
  });

  document.getElementById("newsTitle").value = "";
  document.getElementById("newsContent").value = "";
}

// MURAL AO VIVO
db.collection("news").orderBy("createdAt","desc")
.onSnapshot(snapshot=>{
  const mural = document.getElementById("mural");
  mural.innerHTML = "";
  snapshot.forEach(doc=>{
    const d = doc.data();
    const canEdit = isAdmin && d.uid===ADMIN_UID;
    mural.innerHTML += `
      <div class="postIt" style="background:${d.color}">
        ${canEdit ? '<button onclick="removeNews(\''+doc.id+'\')">X</button>' : ''}
        <h4>${d.title}</h4>
        <p>${d.content}</p>
        <small>${d.date} ${d.time}</small>
      </div>
    `;
  });
});

// REMOVER NOTÍCIA
function removeNews(id){
  if(confirm("Deseja remover esta notícia?")){
    db.collection("news").doc(id).delete();
  }
}
</script>

</body>
</html>
