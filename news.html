<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>R-net Revista</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<style>
body{
  margin:0;
  font-family:Arial;
  background:#f0f0f0;
  color:#111;
}
header{
  background:#111;
  padding:10px;
  text-align:center;
}
.logo{height:55px;}

#revistaContainer{
  display:flex;
  flex-wrap:wrap;
  justify-content:center;
  padding:20px;
  gap:15px;
}

.revistaCard{
  width:300px;
  background:#fff8b0;
  padding:15px;
  border-radius:15px;
  box-shadow: 0 5px 15px rgba(0,0,0,0.2);
  position:relative;
  transition:0.3s;
}

.revistaCard img{
  width:100%;
  border-radius:10px;
  margin-bottom:10px;
}

.revistaCard:hover{
  transform:translateY(-5px);
}

.adminForm{
  margin:20px auto;
  max-width:500px;
  background:#ffeb99;
  padding:20px;
  border-radius:15px;
  box-shadow:0 5px 15px rgba(0,0,0,0.2);
}

.adminForm input, .adminForm textarea{
  width:100%;
  margin-bottom:10px;
  padding:10px;
  border-radius:8px;
  border:1px solid #ccc;
}

.adminForm button{
  background:#ff0055;
  color:white;
  padding:10px 20px;
  border:none;
  border-radius:8px;
  cursor:pointer;
}

.adminBadge{
  position:absolute;
  top:10px;
  right:10px;
  background:#ff0055;
  color:white;
  padding:3px 8px;
  border-radius:8px;
  font-size:12px;
}
</style>
</head>
<body>

<header>
  <img src="logo.png" class="logo">
</header>

<div id="adminSection" class="hidden">
  <form class="adminForm" id="revistaForm">
    <h3>Adicionar Revista</h3>
    <input type="text" id="revistaTitulo" placeholder="Nome da Capa / Título" required>
    <input type="text" id="revistaArtista" placeholder="Nome do Idol / Artista" required>
    <input type="date" id="revistaData" required>
    <input type="file" id="revistaImagem" accept="image/*" required>
    <button type="submit">Publicar Revista</button>
  </form>
</div>

<div id="revistaContainer"></div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCUFift2BuvD433AYTBVNGCNli2PtBMalo",
  authDomain: "rnetnews-273fc.firebaseapp.com",
  projectId: "rnetnews-273fc",
  storageBucket: "rnetnews-273fc.appspot.com",
  messagingSenderId: "856234559611",
  appId: "1:856234559611:web:4b051c2fd1d8f9cb67fade"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const storage = firebase.storage();

// Coloque seu UID de admin aqui
const adminUID = "ITxtdznlxEeXhDoSFcfjYCge6gn1";

// =======================
// CHECAR ADMIN OU VISITANTE
// =======================
let isAdmin = false;

// UID inserido manualmente
let userUID = prompt("Digite seu código de acesso:");

if(userUID === adminUID){
  isAdmin = true;
  document.getElementById("adminSection").classList.remove("hidden");
} else {
  isAdmin = false;
}

// =======================
// FUNÇÃO PARA ADICIONAR REVISTA
// =======================
document.getElementById("revistaForm")?.addEventListener("submit", async function(e){
  e.preventDefault();
  if(!isAdmin) return;

  const titulo = document.getElementById("revistaTitulo").value;
  const artista = document.getElementById("revistaArtista").value;
  const data = document.getElementById("revistaData").value;
  const imagemFile = document.getElementById("revistaImagem").files[0];

  if(!imagemFile) return alert("Selecione uma imagem");

  const storageRef = storage.ref("revistas/"+Date.now()+"_"+imagemFile.name);
  const uploadTask = storageRef.put(imagemFile);

  uploadTask.on("state_changed",
    null,
    (error)=>{ alert("Erro ao enviar: "+error); },
    async ()=>{
      const url = await storageRef.getDownloadURL();
      await db.collection("revistas").add({
        titulo: titulo,
        artista: artista,
        data: data,
        imagem: url,
        criadoEm: firebase.firestore.FieldValue.serverTimestamp()
      });
      alert("Revista publicada!");
      document.getElementById("revistaForm").reset();
    }
  );
});

// =======================
// EXIBIR REVISTAS
// =======================
db.collection("revistas").orderBy("criadoEm","desc")
.onSnapshot(snapshot=>{
  const container = document.getElementById("revistaContainer");
  container.innerHTML = "";

  snapshot.forEach(doc=>{
    const d = doc.data();
    const card = document.createElement("div");
    card.classList.add("revistaCard");
    if(isAdmin){
      const badge = document.createElement("div");
      badge.classList.add("adminBadge");
      badge.innerText = "ADMIN";
      card.appendChild(badge);
    }

    const img = document.createElement("img");
    img.src = d.imagem;
    card.appendChild(img);

    const title = document.createElement("h3");
    title.innerText = d.titulo;
    card.appendChild(title);

    const artista = document.createElement("p");
    artista.innerText = "Artista: "+d.artista;
    card.appendChild(artista);

    const dataEl = document.createElement("p");
    dataEl.innerText = "Data: "+d.data;
    card.appendChild(dataEl);

    container.appendChild(card);
  });
});
</script>
</body>
</html>
