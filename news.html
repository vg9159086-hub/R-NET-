<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>R-net Revista</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<style>
body{
  margin:0;
  font-family:Arial;
  background:#0f0f0f;
  color:white;
}

header{
  background:#111;
  padding:10px;
  text-align:center;
}

.logo{height:55px; margin-bottom:5px;}

#rulesScreen{
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  background:#0f0f0f;
  display:flex; align-items:center; justify-content:center;
  z-index:9999; text-align:center;
}

.rulesBox{
  background:#181818; padding:25px; border-radius:12px;
  max-width:400px;
}

.rulesBox button{
  background:#ff0055; color:white;
  border:none; padding:10px 20px; margin-top:15px;
  border-radius:6px; cursor:pointer;
}

#revistaContainer{
  display:flex; flex-wrap:wrap; justify-content:center; padding:20px;
}

.revistaCard{
  width:300px; background:#fffa8c; color:#111;
  margin:15px; padding:15px; border-radius:12px;
  box-shadow: 0 0 8px #000;
  position:relative; transition:0.4s;
}

.revistaCard img{
  width:100%; border-radius:8px; margin-bottom:8px;
}

.adminControls{
  display:flex; justify-content:space-between; margin-bottom:10px;
}

.adminControls button{
  background:#ff0055; color:white; border:none;
  padding:6px 10px; border-radius:6px; cursor:pointer;
  font-size:12px;
}

input, textarea{
  width:100%; margin-bottom:8px; padding:6px;
  border-radius:6px; border:none;
}

#adminPanel{
  background:#222; padding:15px; margin:15px; border-radius:12px;
  max-width:400px;
}

.newLabel{
  position:absolute; top:8px; right:8px;
  background:#ff0055; color:white; padding:4px 6px;
  font-size:12px; border-radius:6px;
}

</style>
</head>
<body>

<!-- TELA DE REGRAS -->
<div id="rulesScreen">
  <div class="rulesBox">
    <h2>Regras da Revista R-net</h2>
    <p>Somente o administrador pode postar ou editar as revistas.</p>
    <p>Visitantes podem apenas ler e curtir!</p>
    <button onclick="acceptRules()">Concordo</button>
  </div>
</div>

<header>
  <img src="logo.png" class="logo">
  <h1>Revista Mensal R-net</h1>
</header>

<!-- ADMIN PANEL -->
<div id="adminPanel" class="hidden">
  <h3>Postar nova edição</h3>
  <input type="text" id="titulo" placeholder="Título da edição">
  <input type="date" id="dataPub">
  <input type="text" id="horaPub" placeholder="Hora da publicação">
  <input type="file" id="capaFile" accept="image/*">
  <textarea id="conteudo" placeholder="Conteúdo da revista"></textarea>
  <button onclick="postRevista()">Postar</button>
</div>

<div id="revistaContainer"></div>

<script>
// ==================== FIREBASE CONFIG ====================
const firebaseConfig = {
  apiKey: "AIzaSyCUFift2BuvD433AYTBVNGCNli2PtBMalo",
  authDomain: "rnetnews-273fc.firebaseapp.com",
  projectId: "rnetnews-273fc",
  storageBucket: "rnetnews-273fc.firebasestorage.app",
  messagingSenderId: "856234559611",
  appId: "1:856234559611:web:4b051c2fd1d8f9cb67fade"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const storage = firebase.storage();

// ==================== REGRAS ====================
function acceptRules(){
  localStorage.setItem("rulesAccepted","yes");
  document.getElementById("rulesScreen").style.display="none";
}
if(localStorage.getItem("rulesAccepted")==="yes"){
  document.getElementById("rulesScreen").style.display="none";
}

// ==================== ADMIN CHECK ====================
const ADMIN_UID = "ITxtdznlxEeXhDoSFcfjYCge6gn1"; // só você
let isAdmin = false;

// Função simples para perguntar UID
function askUID(){
  const uid = prompt("Digite o código de administrador:");
  if(uid === ADMIN_UID){
    isAdmin = true;
    document.getElementById("adminPanel").classList.remove("hidden");
  } else {
    alert("Modo visitante ativado");
  }
}
askUID();

// ==================== POSTAR REVISTA ====================
async function postRevista(){
  const titulo = document.getElementById("titulo").value;
  const dataPub = document.getElementById("dataPub").value;
  const horaPub = document.getElementById("horaPub").value;
  const conteudo = document.getElementById("conteudo").value;
  const file = document.getElementById("capaFile").files[0];
  if(!titulo || !dataPub || !horaPub || !conteudo || !file){ alert("Preencha tudo!"); return;}

  const storageRef = storage.ref("capas/"+file.name);
  await storageRef.put(file);
  const fileURL = await storageRef.getDownloadURL();

  await db.collection("revistas").add({
    titulo: titulo,
    dataPub: dataPub,
    horaPub: horaPub,
    conteudo: conteudo,
    capa: fileURL,
    createdAt: firebase.firestore.FieldValue.serverTimestamp()
  });

  alert("Revista publicada!");
  document.getElementById("titulo").value="";
  document.getElementById("dataPub").value="";
  document.getElementById("horaPub").value="";
  document.getElementById("conteudo").value="";
  document.getElementById("capaFile").value="";
}

// ==================== CARREGAR REVISTAS ====================
db.collection("revistas")
.orderBy("createdAt","desc")
.onSnapshot(snapshot=>{
  const container = document.getElementById("revistaContainer");
  container.innerHTML="";
  snapshot.forEach(doc=>{
    const data = doc.data();
    const card = document.createElement("div");
    card.className="revistaCard";
    // New face se tiver menos de 1 dia
    const now = new Date();
    let newFace = "";
    if(data.createdAt && (now - data.createdAt.toDate()) < 24*60*60*1000){
      newFace = `<div class="newLabel">NEW FACE</div>`;
    }

    card.innerHTML=`
      ${newFace}
      <img src="${data.capa}">
      <h3>${data.titulo}</h3>
      <p><b>Data:</b> ${data.dataPub} <b>Hora:</b> ${data.horaPub}</p>
      <p>${data.conteudo}</p>
    `;
    container.appendChild(card);
  });
});
</script>
</body>
</html>
