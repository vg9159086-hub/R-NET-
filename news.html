<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>RNet News</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

<style>
body{
  margin:0;
  font-family:Arial;
  background:#f2f2f2;
}

/* Header */
header{
  background:#111;
  color:white;
  padding:10px;
  text-align:center;
}

.logo{height:55px;}

/* Login/Admin */
#loginBox{
  max-width:400px;
  margin:20px auto;
  background:#222;
  padding:20px;
  border-radius:12px;
  color:white;
  text-align:center;
}

#loginBox input{
  width:80%;
  padding:8px;
  margin:5px 0;
  border-radius:6px;
  border:none;
}

#loginBox button{
  background:#ff0055;
  color:white;
  border:none;
  padding:10px 20px;
  border-radius:6px;
  cursor:pointer;
}

/* Mural */
#mural{
  display:flex;
  flex-wrap:wrap;
  justify-content:center;
  margin:20px;
}

/* Post-it */
.postit{
  width:300px;
  min-height:200px;
  margin:10px;
  padding:15px;
  border-radius:12px;
  box-shadow:0 4px 8px rgba(0,0,0,0.2);
  position:relative;
  word-wrap:break-word;
  transition:0.3s;
}

.postit h3{
  margin:0 0 10px 0;
}

.postit img{
  max-width:100%;
  margin-top:10px;
  border-radius:6px;
}

.editBtn, .deleteBtn{
  position:absolute;
  top:5px;
  cursor:pointer;
  background:#111;
  color:white;
  border:none;
  padding:4px 8px;
  border-radius:6px;
  font-size:12px;
}

.editBtn{right:50px;}
.deleteBtn{right:5px;}

/* Cores Post-it */
.yellow{background:#fffa8b;}
.pink{background:#ffb6c1;}
.green{background:#a2fca1;}
.orange{background:#ffc48b;}
</style>
</head>
<body>

<header>
  <img src="logo.png" class="logo">
  <h1>RNet News</h1>
</header>

<!-- LOGIN ADMIN -->
<div id="loginBox">
  <h2>Admin Login</h2>
  <input type="email" id="email" placeholder="Email"><br>
  <input type="password" id="password" placeholder="Senha"><br>
  <button onclick="loginAdmin()">Entrar</button>
  <p id="loginMsg"></p>
</div>

<!-- FORMULARIO POST -->
<div id="postForm" class="hidden" style="max-width:500px;margin:20px auto;background:#222;padding:20px;border-radius:12px;color:white;">
  <h3>Criar / Editar Notícia</h3>
  <input type="text" id="newsTitle" placeholder="Título da notícia"><br>
  <input type="date" id="newsDate"><br>
  <input type="time" id="newsTime"><br>
  <textarea id="newsContent" placeholder="Escreva a notícia..." style="width:95%;height:100px;margin-top:10px;border-radius:6px;padding:8px;"></textarea><br>
  <input type="text" id="newsImage" placeholder="URL da imagem (opcional)"><br>
  <select id="newsColor">
    <option value="yellow">Amarelo</option>
    <option value="pink">Rosa</option>
    <option value="green">Verde</option>
    <option value="orange">Laranja</option>
  </select><br><br>
  <button onclick="submitNews()">Publicar</button>
  <button onclick="cancelEdit()">Cancelar</button>
</div>

<!-- MURAL -->
<div id="mural"></div>

<script>
/* ======================= */
/* FIREBASE CONFIG */
const firebaseConfig = {
  apiKey: "AIzaSyCUFift2BuvD433AYTBVNGCNli2PtBMalo",
  authDomain: "rnetnews-273fc.firebaseapp.com",
  projectId: "rnetnews-273fc",
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const auth = firebase.auth();

const adminUID = "jy7EFx66yFYPVEi5XZaSVYcyWrw2"; // só você pode postar

let editingDoc = null;

/* ======================= */
/* LOGIN ADMIN */
function loginAdmin(){
  const email = document.getElementById("email").value;
  const pass = document.getElementById("password").value;

  auth.signInWithEmailAndPassword(email, pass)
  .then(user=>{
    if(user.user.uid !== adminUID){
      document.getElementById("loginMsg").innerText="Não autorizado!";
      auth.signOut();
      return;
    }
    document.getElementById("loginBox").classList.add("hidden");
    document.getElementById("postForm").classList.remove("hidden");
  })
  .catch(err=>{
    document.getElementById("loginMsg").innerText=err.message;
  });
}

/* ======================= */
/* PUBLICAR / EDITAR */
function submitNews(){
  const title = document.getElementById("newsTitle").value;
  const date = document.getElementById("newsDate").value;
  const time = document.getElementById("newsTime").value;
  const content = document.getElementById("newsContent").value;
  const image = document.getElementById("newsImage").value;
  const color = document.getElementById("newsColor").value;

  if(!title || !content) return alert("Título e conteúdo são obrigatórios");

  const data = {
    title,
    date,
    time,
    content,
    images: image ? [image] : [],
    color,
    uid: adminUID,
    createdAt: firebase.firestore.FieldValue.serverTimestamp()
  };

  if(editingDoc){
    db.collection("news").doc(editingDoc).set(data);
    editingDoc = null;
  } else {
    db.collection("news").add(data);
  }

  document.getElementById("newsTitle").value="";
  document.getElementById("newsDate").value="";
  document.getElementById("newsTime").value="";
  document.getElementById("newsContent").value="";
  document.getElementById("newsImage").value="";
}

/* Cancelar edição */
function cancelEdit(){
  editingDoc=null;
  document.getElementById("newsTitle").value="";
  document.getElementById("newsDate").value="";
  document.getElementById("newsTime").value="";
  document.getElementById("newsContent").value="";
  document.getElementById("newsImage").value="";
}

/* ======================= */
/* MURAL AO VIVO */
db.collection("news").orderBy("createdAt","desc")
.onSnapshot(snapshot=>{
  const mural = document.getElementById("mural");
  mural.innerHTML="";
  snapshot.forEach(doc=>{
    const d = doc.data();
    const post = document.createElement("div");
    post.classList.add("postit");
    post.classList.add(d.color || "yellow");

    post.innerHTML=`
      <h3>${d.title}</h3>
      <p><b>${d.date} ${d.time}</b></p>
      <p>${d.content}</p>
      ${d.images && d.images.length>0 ? `<img src="${d.images[0]}">` : ""}
    `;

    // Só admin vê botões
    auth.onAuthStateChanged(user=>{
      if(user && user.uid === adminUID){
        const editBtn = document.createElement("button");
        editBtn.innerText="Editar";
        editBtn.classList.add("editBtn");
        editBtn.onclick=()=>editNews(doc.id, d);
        post.appendChild(editBtn);

        const delBtn = document.createElement("button");
        delBtn.innerText="Excluir";
        delBtn.classList.add("deleteBtn");
        delBtn.onclick=()=>db.collection("news").doc(doc.id).delete();
        post.appendChild(delBtn);
      }
    });

    mural.appendChild(post);
  });
});

/* ======================= */
/* EDITAR NOTÍCIA */
function editNews(docId, data){
  editingDoc = docId;
  document.getElementById("newsTitle").value = data.title;
  document.getElementById("newsDate").value = data.date;
  document.getElementById("newsTime").value = data.time;
  document.getElementById("newsContent").value = data.content;
  document.getElementById("newsImage").value = data.images && data.images[0] || "";
  document.getElementById("newsColor").value = data.color || "yellow";
}
</script>

</body>
</html>
