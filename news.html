<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>R-net Revista</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:#f0f0f0;
}

header{
  background:#111;
  padding:10px;
  text-align:center;
  color:white;
}

.logo{height:60px;}

#adminPanel{
  display:none;
  padding:20px;
  background:#222;
  color:white;
}

#adminPanel input, #adminPanel textarea{
  width:100%;
  padding:8px;
  margin:5px 0;
  border-radius:6px;
  border:none;
}

#adminPanel button{
  background:#ff0055;
  color:white;
  border:none;
  padding:10px 20px;
  border-radius:6px;
  cursor:pointer;
  margin-top:10px;
}

#posts{
  display:flex;
  flex-wrap:wrap;
  justify-content:center;
  padding:20px;
}

.post{
  width:300px;
  background:linear-gradient(135deg, #fff4a3, #ffd1dc, #b3ffb3, #ffd8a6);
  margin:15px;
  padding:15px;
  border-radius:12px;
  box-shadow:0 4px 8px rgba(0,0,0,0.2);
  position:relative;
}

.post img{
  width:100%;
  border-radius:8px;
  margin-top:10px;
}

.deleteBtn{
  position:absolute;
  top:5px;
  right:5px;
  background:red;
  color:white;
  border:none;
  border-radius:50%;
  width:25px;
  height:25px;
  cursor:pointer;
}

.hidden{display:none;}
</style>
</head>
<body>

<header>
  <img src="logo.png" class="logo">
  <h1>R-net Revista</h1>
</header>

<!-- Admin Panel -->
<div id="adminPanel">
  <h2>Adicionar Notícia</h2>
  <input type="text" id="newsTitle" placeholder="Título da notícia">
  <input type="text" id="newsIdol" placeholder="Nome do Idol / Assunto">
  <input type="file" id="newsImage">
  <textarea id="newsContent" placeholder="Escreva a notícia aqui..."></textarea>
  <button onclick="addNews()">Publicar</button>
</div>

<!-- Mural -->
<div id="posts"></div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCUFift2BuvD433AYTBVNGCNli2PtBMalo",
  authDomain: "rnetnews-273fc.firebaseapp.com",
  projectId: "rnetnews-273fc",
  storageBucket: "rnetnews-273fc.appspot.com",
  messagingSenderId: "856234559611",
  appId: "1:856234559611:web:4b051c2fd1d8f9cb67fade"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const storage = firebase.storage();

// Seu UID de admin
const adminUID = "ITxtdznlxEeXhDoSFcfjYCge6gn1";

// ============================
// LOGIN SIMPLIFICADO
// ============================
let userUID = prompt("Digite seu UID para login (ou deixe vazio para visitante):");

const isAdmin = userUID === adminUID;
if(isAdmin) document.getElementById("adminPanel").style.display = "block";

// ============================
// ADICIONAR NOTÍCIA
// ============================
async function addNews(){
  const title = document.getElementById("newsTitle").value.trim();
  const idol = document.getElementById("newsIdol").value.trim();
  const content = document.getElementById("newsContent").value.trim();
  const file = document.getElementById("newsImage").files[0];

  if(!title || !idol || !content || !file){
    alert("Preencha todos os campos e selecione uma imagem.");
    return;
  }

  // Upload da imagem
  const storageRef = storage.ref('revista/'+file.name);
  await storageRef.put(file);
  const imageURL = await storageRef.getDownloadURL();

  // Salvar notícia
  await db.collection("revista").add({
    title,
    idol,
    content,
    imageURL,
    createdAt: firebase.firestore.FieldValue.serverTimestamp()
  });

  // Limpar campos
  document.getElementById("newsTitle").value = "";
  document.getElementById("newsIdol").value = "";
  document.getElementById("newsContent").value = "";
  document.getElementById("newsImage").value = "";
}

// ============================
// EXIBIR POSTS
// ============================
db.collection("revista").orderBy("createdAt","desc")
.onSnapshot(snapshot=>{
  const postsDiv = document.getElementById("posts");
  postsDiv.innerHTML = "";

  snapshot.forEach(doc=>{
    const d = doc.data();
    const postDiv = document.createElement("div");
    postDiv.classList.add("post");

    let deleteBtnHTML = "";
    if(isAdmin){
      deleteBtnHTML = `<button class="deleteBtn" onclick="deleteNews('${doc.id}')">X</button>`;
    }

    postDiv.innerHTML = `
      ${deleteBtnHTML}
      <h3>${d.title}</h3>
      <h4>${d.idol}</h4>
      <p>${d.content}</p>
      ${d.imageURL?`<img src="${d.imageURL}">`:""}
    `;

    postsDiv.appendChild(postDiv);
  });
});

// ============================
// EXCLUIR NOTÍCIA
// ============================
async function deleteNews(id){
  if(confirm("Deseja realmente apagar essa notícia?")){
    await db.collection("revista").doc(id).delete();
  }
}
</script>

</body>
</html>
