<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>R-net News</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<style>
body {
  margin:0;
  font-family: Arial, sans-serif;
  background:#0f0f0f;
  color:#111;
}
header {
  background:#111;
  padding:10px;
  text-align:center;
}
.logo {height:55px;}
.container {
  display:flex;
  flex-wrap: wrap;
  justify-content: center;
  margin:20px;
  gap:20px;
}
.postit {
  width:300px;
  min-height:200px;
  padding:15px;
  border-radius:12px;
  box-shadow:2px 2px 10px rgba(0,0,0,0.5);
  position: relative;
  white-space: pre-wrap;
  word-wrap: break-word;
}
.postit h3 {
  margin:0 0 10px 0;
}
.postit img {
  max-width:100%;
  margin-top:10px;
  border-radius:8px;
}
button {
  background:#ff0055;
  color:white;
  border:none;
  padding:6px 12px;
  border-radius:6px;
  cursor:pointer;
  margin-top:10px;
}
.admin-panel {
  background:#222;
  padding:15px;
  margin:15px;
  border-radius:12px;
  text-align:center;
}
.hidden {display:none;}
</style>
</head>
<body>

<header>
  <img src="logo.png" class="logo">
</header>

<!-- Painel admin -->
<div id="adminPanel" class="admin-panel hidden">
  <h2>Postar Notícia</h2>
  <input type="text" id="newsTitle" placeholder="Título" style="width:80%; margin-bottom:5px;"><br>
  <textarea id="newsContent" placeholder="Conteúdo" style="width:80%; height:80px;"></textarea><br>
  <input type="text" id="newsImage" placeholder="URL da imagem (opcional)" style="width:80%; margin-top:5px;"><br>
  <select id="newsColor" style="margin-top:5px;">
    <option value="#FFEB3B">Amarelo</option>
    <option value="#FF8A80">Rosa</option>
    <option value="#81C784">Verde</option>
    <option value="#FFB74D">Laranja</option>
  </select><br>
  <button onclick="postNews()">Postar</button>
</div>

<!-- Mural -->
<div class="container" id="newsContainer"></div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCUFift2BuvD433AYTBVNGCNli2PtBMalo",
  authDomain: "rnetnews-273fc.firebaseapp.com",
  projectId: "rnetnews-273fc",
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// UID do Admin
const ADMIN_UID = "jy7EFx66yFYPVEi5XZaSVYcyWrw2";

// Simulação de UID (você pode colocar login real ou cookie)
let userUID = prompt("Coloque seu UID (deixe vazio para visitante):") || "visitor";

// Mostrar painel admin só pro UID correto
if(userUID === ADMIN_UID){
  document.getElementById("adminPanel").classList.remove("hidden");
}

// Função de postar notícia
async function postNews(){
  const title = document.getElementById("newsTitle").value;
  const content = document.getElementById("newsContent").value;
  const image = document.getElementById("newsImage").value;
  const color = document.getElementById("newsColor").value;

  if(!title || !content) return alert("Título e conteúdo são obrigatórios!");

  await db.collection("news").add({
    title, content, image, color,
    createdAt: firebase.firestore.FieldValue.serverTimestamp()
  });

  document.getElementById("newsTitle").value="";
  document.getElementById("newsContent").value="";
  document.getElementById("newsImage").value="";
}

// Função remover notícia
async function removeNews(id){
  if(userUID !== ADMIN_UID) return;
  await db.collection("news").doc(id).delete();
}

// Função editar notícia
async function editNews(id, currentTitle, currentContent, currentImage, currentColor){
  if(userUID !== ADMIN_UID) return;

  const newTitle = prompt("Novo título:", currentTitle);
  const newContent = prompt("Novo conteúdo:", currentContent);
  const newImage = prompt("Nova URL da imagem:", currentImage);
  const newColor = prompt("Nova cor (hex):", currentColor);

  if(!newTitle || !newContent) return alert("Título e conteúdo obrigatórios!");

  await db.collection("news").doc(id).update({
    title:newTitle,
    content:newContent,
    image:newImage,
    color:newColor
  });
}

// Exibir notícias
db.collection("news").orderBy("createdAt","desc")
.onSnapshot(snapshot=>{
  const container = document.getElementById("newsContainer");
  container.innerHTML="";
  snapshot.forEach(doc=>{
    const d = doc.data();
    const post = document.createElement("div");
    post.className="postit";
    post.style.background=d.color || "#FFEB3B";

    let html = `<h3>${d.title}</h3>`;
    html += `<p>${d.content}</p>`;
    if(d.image) html += `<img src="${d.image}">`;
    html += `<p style="font-size:12px; color:#333;">${d.createdAt ? new Date(d.createdAt.toDate()).toLocaleString() : ""}</p>`;

    // Botões só pro admin
    if(userUID === ADMIN_UID){
      html += `<button onclick="editNews('${doc.id}','${escapeHtml(d.title)}','${escapeHtml(d.content)}','${d.image || ''}','${d.color || '#FFEB3B'}')">Editar</button>`;
      html += `<button onclick="removeNews('${doc.id}')">Remover</button>`;
    }

    post.innerHTML = html;
    container.appendChild(post);
  });
});

// Função de escape pra não quebrar string no prompt
function escapeHtml(text){
  if(!text) return "";
  return text.replace(/'/g,"\\'").replace(/"/g,'\\"');
}
</script>
</body>
</html>
