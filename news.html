<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>R-net News</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{
  margin:0;
  font-family:Arial;
  background:#f0f0f0;
}
header{
  background:#111;
  padding:10px;
  text-align:center;
  color:white;
}
.logo{height:60px;}
#newsBoard{
  display:flex;
  flex-wrap:wrap;
  padding:20px;
  justify-content:center;
}
.newsCard{
  width:280px;
  min-height:200px;
  margin:15px;
  padding:15px;
  border-radius:12px;
  box-shadow:0 4px 6px rgba(0,0,0,0.2);
  position:relative;
  word-wrap:break-word;
  transition:0.3s;
}
.newsCard:hover{transform:scale(1.03);}
.newsTitle{font-weight:bold;margin-bottom:8px;}
.newsMeta{font-size:12px;color:#333;margin-bottom:10px;}
.postForm input, .postForm textarea{width:100%;margin-bottom:10px;padding:6px;border-radius:6px;border:1px solid #aaa;}
.postForm button{padding:8px 12px;background:#ff0055;color:white;border:none;border-radius:6px;cursor:pointer;}
.deleteBtn{position:absolute;top:5px;right:5px;background:red;color:white;border:none;padding:4px 6px;border-radius:6px;cursor:pointer;}
.editBtn{position:absolute;top:5px;right:50px;background:green;color:white;border:none;padding:4px 6px;border-radius:6px;cursor:pointer;}
</style>
</head>
<body>

<header>
  <img src="logo.png" class="logo">
  <h2>R-net News</h2>
</header>

<!-- POST FORM (Aparece só pro admin) -->
<div id="postForm" class="postForm" style="display:none; padding:20px;">
  <h3>Adicionar Notícia</h3>
  <input type="text" id="newsTitle" placeholder="Nome da notícia">
  <input type="date" id="newsDate">
  <input type="time" id="newsTime">
  <textarea id="newsContent" placeholder="Escreva a notícia aqui..."></textarea>
  <input type="text" id="newsImages" placeholder="URLs de imagens (separadas por vírgula)">
  <button onclick="addNews()">Postar Notícia</button>
</div>

<div id="newsBoard"></div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCUFift2BuvD433AYTBVNGCNli2PtBMalo",
  authDomain: "rnetnews-273fc.firebaseapp.com",
  projectId: "rnetnews-273fc",
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// ================= ADMIN UID =================
const ADMIN_UID = "jy7EFx66yFYPVEi5XZaSVYcyWrw2";

// ================= LOGIN SIMPLIFICADO =================
let userUID = prompt("Digite seu UID (Deixe em branco se visitante):") || "";

if(userUID === ADMIN_UID){
  document.getElementById("postForm").style.display = "block";
}

// ================= FUNÇÃO ADICIONAR NOTÍCIA =================
async function addNews(){
  const title = document.getElementById("newsTitle").value;
  const content = document.getElementById("newsContent").value;
  const date = document.getElementById("newsDate").value;
  const time = document.getElementById("newsTime").value;
  const images = document.getElementById("newsImages").value.split(",").map(i=>i.trim()).filter(i=>i);

  if(!title || !content) return alert("Preencha título e conteúdo");

  await db.collection("news").add({
    title, content, date, time, images,
    adminUID: ADMIN_UID,
    createdAt: firebase.firestore.FieldValue.serverTimestamp()
  });

  document.getElementById("newsTitle").value="";
  document.getElementById("newsContent").value="";
  document.getElementById("newsDate").value="";
  document.getElementById("newsTime").value="";
  document.getElementById("newsImages").value="";
}

// ================= FUNÇÃO REMOVER =================
async function removeNews(id){
  if(confirm("Tem certeza que quer remover?")){
    await db.collection("news").doc(id).delete();
  }
}

// ================= FUNÇÃO EDITAR =================
function editNews(id, data){
  const newTitle = prompt("Editar título:", data.title);
  const newContent = prompt("Editar conteúdo:", data.content);
  if(newTitle && newContent){
    db.collection("news").doc(id).update({title:newTitle, content:newContent});
  }
}

// ================= EXIBIR NOTÍCIAS =================
const colors = ["#fffa65","#ff8c94","#81ecec","#f6b93b"];

db.collection("news").orderBy("createdAt","desc").onSnapshot(snapshot=>{
  const board = document.getElementById("newsBoard");
  board.innerHTML = "";

  snapshot.forEach(doc=>{
    const d = doc.data();
    const color = colors[Math.floor(Math.random()*colors.length)];
    const card = document.createElement("div");
    card.className="newsCard";
    card.style.background=color;

    let html = `<div class="newsTitle">${d.title}</div>
                <div class="newsMeta">${d.date} ${d.time}</div>
                <div class="newsContent">${d.content}</div>`;

    if(d.images && d.images.length>0){
      d.images.forEach(img=>{
        html += `<img src="${img}" style="width:100%;margin-top:6px;border-radius:6px;">`;
      });
    }

    if(userUID === ADMIN_UID){
      html += `<button class="deleteBtn" onclick="removeNews('${doc.id}')">X</button>`;
      html += `<button class="editBtn" onclick="editNews('${doc.id}', ${JSON.stringify(d)})">Edit</button>`;
    }

    card.innerHTML = html;
    board.appendChild(card);
  });
});
</script>

</body>
</html>
