<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>R-net News</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js"></script>

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:#0f0f0f;
  color:white;
  overflow-x:hidden;
}

header{
  background:#111;
  padding:10px;
  text-align:center;
}

.logo{height:60px;}

nav button{
  background:#ff0055;
  color:white;
  border:none;
  padding:8px 14px;
  margin:5px;
  border-radius:6px;
  cursor:pointer;
}

/* MURAL estilo Pinterest */
#mural{
  display:flex;
  flex-wrap: wrap;
  padding:20px;
  justify-content:flex-start;
}

/* POST-IT */
.postIt{
  width:280px;
  min-height:200px;
  margin:15px;
  padding:15px;
  border-radius:12px;
  color:#111;
  font-weight:bold;
  position:relative;
  transition:0.3s;
  box-shadow:0 8px 15px rgba(0,0,0,0.4);
  cursor:grab;
}
.postIt:hover{transform:scale(1.05);}

/* Cores */
.postYellow{background:#fff176;}
.postPink{background:#f48fb1;}
.postGreen{background:#81c784;}
.postOrange{background:#ffb74d;}

/* New Face */
.newFace{
  position:absolute;
  top:8px;
  right:8px;
  background:red;
  color:white;
  padding:2px 6px;
  border-radius:6px;
  font-size:12px;
}

/* Botões admin */
.postButtons{
  position:absolute;
  bottom:8px;
  right:8px;
}
.postButtons button{
  background:#ff0055;
  color:white;
  border:none;
  padding:4px 8px;
  margin-left:4px;
  border-radius:6px;
  cursor:pointer;
  font-size:12px;
}

/* Imagem na notícia */
.postImg{
  width:100%;
  max-height:150px;
  margin-top:8px;
  border-radius:8px;
  object-fit:cover;
}
</style>
</head>
<body>

<header>
  <img src="logo.png" class="logo">
  <nav>
    <button onclick="newPost()">Nova Notícia</button>
  </nav>
</header>

<div id="mural"></div>

<script>
// ========================
// CONFIG FIREBASE
// ========================
const firebaseConfig = {
  apiKey: "AIzaSyCUFift2BuvD433AYTBVNGCNli2PtBMalo",
  authDomain: "rnetnews-273fc.firebaseapp.com",
  projectId: "rnetnews-273fc",
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// ========================
// CONFIG ADMIN
// ========================
const adminUID = "jy7EFx66yFYPVEi5XZaSVYcyWrw2";
let currentUserUID = prompt("Digite seu UID (ou deixe vazio para visitante)");

// ========================
// NOVA NOTÍCIA
// ========================
function newPost(){
  if(currentUserUID !== adminUID){
    alert("Somente o admin pode postar notícias!");
    return;
  }

  const title = prompt("Nome da notícia:");
  const date = prompt("Data de publicação (YYYY-MM-DD):", new Date().toISOString().split("T")[0]);
  const time = prompt("Hora da publicação (HH:MM):", new Date().toTimeString().split(" ")[0].slice(0,5));
  const content = prompt("Escreva a notícia:");
  const image = prompt("URL da imagem (opcional):");
  const colorOptions = ["postYellow","postPink","postGreen","postOrange"];
  const color = colorOptions[Math.floor(Math.random()*colorOptions.length)];

  if(title && content){
    db.collection("news").add({
      title,
      date,
      time,
      content,
      image: image || "",
      color,
      createdAt:firebase.firestore.FieldValue.serverTimestamp()
    });
  }
}

// ========================
// EDITAR NOTÍCIA
// ========================
function editPost(id){
  if(currentUserUID !== adminUID) return;

  const docRef = db.collection("news").doc(id);
  docRef.get().then(doc=>{
    if(!doc.exists) return;
    const data = doc.data();

    const newTitle = prompt("Editar título:", data.title);
    const newDate = prompt("Editar data:", data.date);
    const newTime = prompt("Editar hora:", data.time);
    const newContent = prompt("Editar notícia:", data.content);
    const newImage = prompt("Editar URL da imagem:", data.image);

    if(newTitle && newContent){
      docRef.update({
        title:newTitle,
        date:newDate,
        time:newTime,
        content:newContent,
        image:newImage
      });
    }
  });
}

// ========================
// REMOVER NOTÍCIA
// ========================
function removePost(id){
  if(currentUserUID !== adminUID) return;
  if(confirm("Deseja remover esta notícia?")){
    db.collection("news").doc(id).delete();
  }
}

// ========================
// MOSTRAR NOTÍCIAS
// ========================
db.collection("news")
.orderBy("createdAt","desc")
.onSnapshot(snapshot=>{
  const mural = document.getElementById("mural");
  mural.innerHTML = "";

  snapshot.forEach(doc=>{
    const d = doc.data();
    const now = new Date();
    const created = d.createdAt ? d.createdAt.toDate() : now;
    const diffHours = (now - created)/(1000*60*60);

    let newFaceLabel = diffHours < 24 ? `<div class="newFace">New Face</div>` : "";

    let buttons = "";
    if(currentUserUID === adminUID){
      buttons = `
        <div class="postButtons">
          <button onclick="editPost('${doc.id}')">Editar</button>
          <button onclick="removePost('${doc.id}')">Remover</button>
        </div>
      `;
    }

    mural.innerHTML += `
      <div class="postIt ${d.color}" id="${doc.id}">
        ${newFaceLabel}
        <h3>${d.title}</h3>
        <p><i>${d.date} ${d.time}</i></p>
        <p>${d.content}</p>
        ${d.image ? `<img class="postImg" src="${d.image}">` : ""}
        ${buttons}
      </div>
    `;
  });

  // ========================
  // TORNA POST-ITS ARRÁSTAVEIS
  // ========================
  interact('.postIt').draggable({
    inertia:true,
    modifiers: [
      interact.modifiers.restrictRect({
        restriction: 'parent',
        endOnly: true
      })
    ],
    autoScroll:true,
    listeners:{
      move: dragMoveListener
    }
  });
});

function dragMoveListener (event) {
  const target = event.target;
  const x = (parseFloat(target.getAttribute('data-x')) || 0) + event.dx;
  const y = (parseFloat(target.getAttribute('data-y')) || 0) + event.dy;

  target.style.transform = `translate(${x}px, ${y}px)`;
  target.setAttribute('data-x', x);
  target.setAttribute('data-y', y);
}
</script>

</body>
</html>
