<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>MVZONE</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<style>
body{
  margin:0;
  font-family:Arial;
  background:#0f0f0f;
  color:white;
}

header{
  background:#111;
  padding:10px;
  text-align:center;
}

.logo{height:55px;}

nav button{
  background:#ff0055;
  color:white;
  border:none;
  padding:8px 14px;
  margin:5px;
  border-radius:6px;
  cursor:pointer;
}

.card{
  background:#181818;
  padding:15px;
  margin:15px;
  border-radius:12px;
  transition:0.4s;
  animation:fadeIn 0.4s ease;
}

.card.move{
  transform:translateY(-6px);
}

.voteImg{
  width:40px;
  cursor:pointer;
  margin:6px;
}

.hidden{display:none;}

.trophy{color:gold;}

.top1{
  border:2px solid gold;
  box-shadow:0 0 15px gold;
  animation:glowPulse 1.5s infinite alternate;
}

@keyframes glowPulse{
  from{ box-shadow:0 0 10px gold; }
  to{ box-shadow:0 0 30px gold; }
}

@keyframes fadeIn{
from{opacity:0; transform:translateY(15px);}
to{opacity:1; transform:translateY(0);}
}

/* REGRAS */
#rulesScreen{
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background:#0f0f0f;
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:9999;
}

.rulesBox{
  background:#181818;
  padding:25px;
  border-radius:12px;
  text-align:center;
}
</style>
</head>

<body>

<div id="rulesScreen">
  <div class="rulesBox">
    <h2>Regras do MVZONE</h2>
    <p>Os votos s√£o ilimitados, use com sabedoria e apoie seu artista.</p>
    <p>D√™ chance a todos os MVs do MVZONE.</p>
    <button onclick="acceptRules()">Concordo</button>
  </div>
</div>

<header>
  <img src="logo.png" class="logo">
  <nav>
    <button onclick="showCharts()">Charts</button>
    <button onclick="showHistory()">Hist√≥ria</button>
    <button onclick="showHall()">Hall da Fama</button>
  </nav>
</header>

<div id="charts"></div>

<div id="history" class="hidden" style="padding:20px;">
<h2>Sobre o R-net</h2>
<p>
o R-net surgiu de uma ideia rescente, ap√≥s uma reuni√£o de colaboradores surgiu o R-net, esse site consiste em existir um chart autom√°tico para o Rpop e KUV, ele atualiza automaticamente, toda semana o placar zera e come√ßa novamente, depois de 30 dias os MVS s√£o removidos e podem ser adicionados apenas MVS rescentes (2 meses) no m√°ximo, os grupos/solistas contam com seus f√£s para ganhar o primeiro lugar na parada musical do rpop/kuv, contamos com o apoio de todos voc√™s para crescermos a popularidade de cada um
</p>
</div>

<div id="hall" class="hidden"></div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyDa1Lm_bSz18M11gT0CZio-CG0mOqvBd7I",
  authDomain: "mvzone-29363.firebaseapp.com",
  projectId: "mvzone-29363",
  };

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const charts = document.getElementById("charts");
const historyDiv = document.getElementById("history");
const hall = document.getElementById("hall");
const rulesScreen = document.getElementById("rulesScreen");

let lastPositions = {};
let currentFirst = null;
const victorySound = new Audio("victory.mp3");

/* REGRAS */
function acceptRules(){
  localStorage.setItem("rulesAccepted","yes");
  rulesScreen.style.display="none";
}
if(localStorage.getItem("rulesAccepted")==="yes"){
  rulesScreen.style.display="none";
}

/* NAVEGA√á√ÉO */
function showCharts(){
  charts.classList.remove("hidden");
  historyDiv.classList.add("hidden");
  hall.classList.add("hidden");
}
function showHistory(){
  charts.classList.add("hidden");
  historyDiv.classList.remove("hidden");
  hall.classList.add("hidden");
}
function showHall(){
  charts.classList.add("hidden");
  historyDiv.classList.add("hidden");
  hall.classList.remove("hidden");

  hall.innerHTML="<h2>üèÜ Hall da Fama Mensal</h2>";

  db.collection("hallOfFame")
  .orderBy("createdAt","desc")
  .onSnapshot(snapshot=>{
    hall.innerHTML="<h2>üèÜ Hall da Fama Mensal</h2>";
    snapshot.forEach(doc=>{
      const d=doc.data();
      hall.innerHTML+=`
      <div class="card">
      <h3>${d.month}</h3>
      <p><b>${d.artist}</b> - ${d.title}</p>
      <p>Empresa: ${d.company||"-"}</p>
      <p>Pontos: ${d.points}</p>
      </div>`;
    });
  });
}

/* CONFETE */
function launchConfetti(){
  confetti({particleCount:150,spread:100,origin:{y:0.6}});
}

/* RESET SEMANAL + CONFIG */
async function ensureConfig(){
  const ref=db.collection("system").doc("config");
  const doc=await ref.get();
  if(!doc.exists){
    await ref.set({lastReset:"",lastMonthly:""});
  }
}
ensureConfig();

/* VOTAR */
async function vote(id,value){
  const ref=db.collection("mvs").doc(id);
  const doc=await ref.get();
  await ref.update({points:(doc.data().points||0)+value});
}

/* CHART AO VIVO */
db.collection("mvs").orderBy("points","desc")
.onSnapshot(snapshot=>{
  charts.innerHTML="";
  let position=1;
  let newFirst=null;

  snapshot.forEach(doc=>{
    const d=doc.data();
    if(position===1) newFirst=doc.id;

    let moveClass="";
    if(lastPositions[doc.id] && lastPositions[doc.id]!==position){
      moveClass="move";
    }
    lastPositions[doc.id]=position;

    charts.innerHTML+=`
    <div class="card ${moveClass} ${position===1?'top1':''}">
    <h3>#${position} ${d.artist} ${position===1?'üèÜ':''}</h3>
    <p>${d.title}</p>
    <p>Empresa: ${d.company||"-"}</p>
    <iframe width="100%" height="220"
    src="https://www.youtube.com/embed/${extractID(d.url)}"
    frameborder="0" allowfullscreen></iframe>
    <p>Pontos: ${d.points||0}</p>
    <img src="like.png" class="voteImg" onclick="vote('${doc.id}',1)">
    <img src="deslike.png" class="voteImg" onclick="vote('${doc.id}',-1)">
    </div>`;

    position++;
  });

  if(currentFirst && currentFirst!==newFirst){
    victorySound.play();
    launchConfetti();
  }
  currentFirst=newFirst;
});

/* YT ID */
function extractID(url){
  const regExp=/(?:youtube\.com\/.*v=|youtu\.be\/)([^&]+)/;
  const match=url.match(regExp);
  return match?match[1]:"";
}
</script>

</body>
</html>
