<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>RNET MV Zone Online</title>
<style>
body{margin:0;font-family:Arial;background:#000;color:#fff;padding:10px;}
header{background:#111;color:#ff2d8b;text-align:center;font-size:22px;font-weight:bold;padding:10px;}
.container{padding:10px;}
.card{background:#111;padding:10px;margin-bottom:15px;border-radius:10px;}
button{background:#ff2d8b;border:none;color:#fff;padding:5px 10px;margin:2px;border-radius:5px;cursor:pointer;}
input{width:90%;padding:5px;margin:5px 0;border-radius:5px;border:none;}
.hidden{display:none;}
</style>
</head>
<body>

<header>RNET</header>
<div class="container">

<!-- LOGIN -->
<div id="login" class="card">
<h2>Entrar como:</h2>
<button onclick="entrarEmpresa()">Empresa</button>
<button onclick="entrarVisitante()">Visitante</button>
</div>

<!-- LABEL -->
<div id="label" class="hidden card">
<h2>Adicionar Artista (Empresa)</h2>
<input id="artistaNome" placeholder="Nome do Artista">
<input id="empresaNome" placeholder="Nome da Empresa">
<input id="mvLink" placeholder="Link do MV (YouTube)">
<button onclick="adicionarArtista()">Adicionar</button>

<h3>Artistas Cadastrados</h3>
<div id="listaArtistas"></div>
</div>

<!-- MV ZONE -->
<div id="mvzone" class="hidden card">
<h2>MV Zone / Charts</h2>
<div id="ranking"></div>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
// ============================
// CONFIGURA√á√ÉO FIREBASE
// ============================
const firebaseConfig = {
  apiKey: "SUA_API_KEY",
  authDomain: "SEU_PROJETO.firebaseapp.com",
  databaseURL: "https://SEU_PROJETO-default-rtdb.firebaseio.com",
  projectId: "SEU_PROJETO",
  storageBucket: "SEU_PROJETO.appspot.com",
  messagingSenderId: "SEU_SENDER_ID",
  appId: "SEU_APP_ID"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// ============================
// GERAR ID √öNICO DE USU√ÅRIO
// ============================
let userID = localStorage.getItem("rnet_userID");
if(!userID){
    userID = "user_"+Math.random().toString(36).substr(2,9);
    localStorage.setItem("rnet_userID", userID);
}

// ============================
// LOGIN
// ============================
let isEmpresa = false;
function entrarEmpresa(){
    isEmpresa = true;
    document.getElementById("login").classList.add("hidden");
    document.getElementById("label").classList.remove("hidden");
    document.getElementById("mvzone").classList.remove("hidden");
}
function entrarVisitante(){
    isEmpresa = false;
    document.getElementById("login").classList.add("hidden");
    document.getElementById("mvzone").classList.remove("hidden");
}

// ============================
// ADICIONAR ARTISTA
// ============================
function adicionarArtista(){
    if(!isEmpresa){ alert("Somente empresas podem adicionar artistas!"); return; }
    let nome = document.getElementById("artistaNome").value.trim();
    let empresa = document.getElementById("empresaNome").value.trim();
    let mv = document.getElementById("mvLink").value.trim();
    if(!nome || !empresa || !mv){ alert("Preencha todos os campos!"); return; }

    // Limite 15 artistas por empresa
    db.ref("mvs").orderByChild("empresa").equalTo(empresa).once("value", snap=>{
        if(snap.exists() && Object.keys(snap.val()).length >= 15){
            alert("Limite de artistas da empresa atingido!");
            return;
        }

        let id = "mv_"+Date.now();
        db.ref("mvs/"+id).set({
            id:id,
            nome:nome,
            empresa:empresa,
            url:mv,
            pontos:0,
            likes:[],
            dislikes:[],
            comentarios:[],
            data:Date.now()
        });
        document.getElementById("artistaNome").value="";
        document.getElementById("empresaNome").value="";
        document.getElementById("mvLink").value="";
    });
}

// ============================
// RENDER RANKING / MV ZONE
// ============================
function renderRanking(){
    db.ref("mvs").once("value").then(snap=>{
        let artistas = snap.val() || {};
        const now = Date.now();

        // Remove MVs com mais de 1 m√™s
        Object.keys(artistas).forEach(k=>{
            if(now - artistas[k].data > 30*24*60*60*1000){
                db.ref("mvs/"+k).remove();
                delete artistas[k];
            }
        });

        // Ordenar por pontos
        let ordenado = Object.values(artistas).sort((a,b)=>b.pontos - a.pontos).slice(0,100);
        let ranking = document.getElementById("ranking");
        ranking.innerHTML="";

        ordenado.forEach(a=>{
            let userLiked = a.likes.includes(userID);
            let userDisliked = a.dislikes.includes(userID);
            ranking.innerHTML+=`
            <div class="card">
            <h3>${a.nome} (${a.empresa}) - ${a.pontos} pts</h3>
            <iframe width="100%" height="200" src="${a.url.replace("watch?v=","embed/")}" frameborder="0" allowfullscreen></iframe>
            <div>
            <button onclick="darLike('${a.id}')">${userLiked?'Remover Like':'üëç Like'}</button>
            <button onclick="darDislike('${a.id}')">${userDisliked?'Remover Deslike':'üëé Deslike'}</button>
            </div>
            <div>
            <input id="nomeC_${a.id}" placeholder="Seu nome">
            <input id="comC_${a.id}" placeholder="Coment√°rio">
            <button onclick="comentar('${a.id}')">Comentar</button>
            </div>
            <div>${a.comentarios.map(c=>`<p><b>${c.user}:</b> ${c.texto} ${c.userID==userID?'<button onclick="removerComentario(\''+a.id+'\',\''+c.id+'\')">X</button>':''}</p>`).join("")}</div>
            </div>
            `;
        });
    });
}

// ============================
// LIKE / DISLIKE
// ============================
function darLike(id){
    db.ref("mvs/"+id).once("value").then(snap=>{
        let a = snap.val();
        if(!a) return;
        let likes = a.likes || [];
        let dislikes = a.dislikes || [];
        let pontos = a.pontos || 0;

        if(likes.includes(userID)){
            likes = likes.filter(x=>x!=userID);
            pontos -=5;
        } else {
            if(dislikes.includes(userID)){
                dislikes = dislikes.filter(x=>x!=userID);
                pontos +=5;
            }
            likes.push(userID);
            pontos +=5;
        }
        db.ref("mvs/"+id).update({likes:likes, dislikes:dislikes, pontos:pontos});
        renderRanking();
    });
}
function darDislike(id){
    db.ref("mvs/"+id).once("value").then(snap=>{
        let a = snap.val();
        if(!a) return;
        let likes = a.likes || [];
        let dislikes = a.dislikes || [];
        let pontos = a.pontos || 0;

        if(dislikes.includes(userID)){
            dislikes = dislikes.filter(x=>x!=userID);
            pontos +=5;
        } else {
            if(likes.includes(userID)){
                likes = likes.filter(x=>x!=userID);
                pontos -=5;
            }
            dislikes.push(userID);
            pontos -=5;
        }
        db.ref("mvs/"+id).update({likes:likes, dislikes:dislikes, pontos:pontos});
        renderRanking();
    });
}

// ============================
// COMENT√ÅRIOS
// ============================
function comentar(id){
    let user = document.getElementById("nomeC_"+id).value.trim();
    let texto = document.getElementById("comC_"+id).value.trim();
    if(!user || !texto) return;

    let commentID = userID+"_"+Date.now();
    db.ref("mvs/"+id+"/comentarios/"+commentID).set({
        id:commentID,
        userID:userID,
        user:user,
        texto:texto
    });
    renderRanking();
}
function removerComentario(mvID, comID){
    db.ref("mvs/"+mvID+"/comentarios/"+comID).once("value").then(snap=>{
        if(snap.val().userID==userID){
            db.ref("mvs/"+mvID+"/comentarios/"+comID).remove();
            renderRanking();
        }
    });
}

// ============================
// RESET SEMANAL AUTOM√ÅTICO
// ============================
setInterval(()=>{
    db.ref("mvs").once("value").then(snap=>{
        let artistas = snap.val() || {};
        Object.keys(artistas).forEach(k=>{
            db.ref("mvs/"+k).update({pontos:0});
        });
        renderRanking();
    });
},7*24*60*60*1000); // 7 dias

// ============================
// LISTENER REAL TIME
// ============================
db.ref("mvs").on("value", renderRanking);

</script>
</body>
</html>
