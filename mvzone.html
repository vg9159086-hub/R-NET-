<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>MVZONE</title>

<style>
body {
    font-family: Arial;
    background: #111;
    color: white;
    text-align: center;
}

input, button {
    padding: 8px;
    margin: 5px;
}

.video {
    border: 1px solid #444;
    padding: 10px;
    margin: 15px;
}

iframe {
    width: 300px;
    height: 170px;
}
</style>
</head>
<body>

<h1>MVZONE</h1>

<h2>Cadastrar MV</h2>

<input id="artist" placeholder="Artista">
<input id="title" placeholder="TÃ­tulo do MV">
<input id="youtube" placeholder="Link do YouTube">
<br>
<button onclick="addMV()">Cadastrar</button>

<hr>

<h2>MVs</h2>
<div id="videos"></div>

<!-- Firebase -->
<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import {
  getFirestore,
  collection,
  addDoc,
  getDocs,
  updateDoc,
  doc
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

/* COLE AQUI OS DADOS DO SEU FIREBASE */
const firebaseConfig = {
  apiKey: "AIzaSyDa1Lm_bSz18M11gT0CZio-CG0mOqvBd7I",
  authDomain: "mvzone-29363.firebaseapp.com",
  projectId: "mvzone-29363",
  storageBucket: "mvzone-29363.firebasestorage.app",
  messagingSenderId: "927971258967",
  appId: "1:927971258967:web:37ebd9479ecfa643f7e912"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* Converte qualquer link do YouTube para EMBED */
function convertToEmbed(url) {
    let videoId = "";

    if (url.includes("youtu.be")) {
        videoId = url.split("youtu.be/")[1].split("?")[0];
    } 
    else if (url.includes("watch?v=")) {
        videoId = url.split("watch?v=")[1].split("&")[0];
    }
    else if (url.includes("embed/")) {
        return url;
    }

    return "https://www.youtube.com/embed/" + videoId;
}

/* Adicionar MV */
window.addMV = async function () {
    const artist = document.getElementById("artist").value;
    const title = document.getElementById("title").value;
    const youtube = document.getElementById("youtube").value;

    const embedUrl = convertToEmbed(youtube);

    await addDoc(collection(db, "mvs"), {
        artist: artist,
        title: title,
        youtubeUrl: embedUrl,
        likes: 0
    });

    loadVideos();
};

/* Curtir */
window.likeVideo = async function (id, likes) {
    const ref = doc(db, "mvs", id);
    await updateDoc(ref, {
        likes: likes + 1
    });
    loadVideos();
};

/* Descurtir */
window.dislikeVideo = async function (id, likes) {
    const ref = doc(db, "mvs", id);
    await updateDoc(ref, {
        likes: likes - 1
    });
    loadVideos();
};

/* Carregar vÃ­deos */
async function loadVideos() {
    const container = document.getElementById("videos");
    container.innerHTML = "";

    const querySnapshot = await getDocs(collection(db, "mvs"));

    querySnapshot.forEach((docItem) => {
        const data = docItem.data();

        container.innerHTML += `
        <div class="video">
            <h3>${data.artist} - ${data.title}</h3>
            <iframe src="${data.youtubeUrl}" frameborder="0" allowfullscreen></iframe>
            <p>Pontos: ${data.likes}</p>
            <button onclick="likeVideo('${docItem.id}', ${data.likes})">ğŸ‘</button>
            <button onclick="dislikeVideo('${docItem.id}', ${data.likes})">ğŸ‘</button>
        </div>
        `;
    });
}

loadVideos();

</script>

</body>
</html>
