<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RNET ‚Ä¢ MV Zone</title>

<style>
body{
    margin:0;
    background:#000;
    color:white;
    font-family:Arial;
}

.header{
    position:sticky;
    top:0;
    background:#000;
    display:flex;
    align-items:center;
    gap:10px;
    padding:10px 15px;
    border-bottom:1px solid #222;
    z-index:100;
}

.logo{
    height:40px;
}

h1{
    color:#ff2d7a;
    margin:0;
}

.container{
    padding:15px;
}

.mv{
    background:#111;
    padding:15px;
    border-radius:15px;
    margin-bottom:20px;
}

.mv h3{
    color:#ff2d7a;
    margin:0 0 5px 0;
}

.info{
    font-size:13px;
    color:#aaa;
    margin-bottom:10px;
}

iframe{
    width:100%;
    height:200px;
    border-radius:10px;
    border:none;
}

.actions{
    display:flex;
    gap:20px;
    margin-top:10px;
    align-items:center;
}

.actions img{
    width:35px;
    cursor:pointer;
}

.score{
    margin-top:8px;
    font-weight:bold;
}

.comment-box{
    width:100%;
    padding:8px;
    margin-top:10px;
    border-radius:8px;
    border:none;
}

.comment{
    background:#222;
    padding:8px;
    border-radius:8px;
    margin-top:8px;
    font-size:14px;
}

.delete{
    color:red;
    font-size:12px;
    cursor:pointer;
}
</style>
</head>
<body>

<div class="header">
    <img src="logo.png" class="logo">
    <h1>MV Zone</h1>
</div>

<div class="container" id="area"></div>

<script>

// ===== USU√ÅRIO =====
let user = JSON.parse(localStorage.getItem("usuarioLogado")) || {nome:"Visitante", id:"visit"};

// ===== LABEL POSTS (EMPRESAS) =====
let labels = JSON.parse(localStorage.getItem("labels")) || [];

// ===== MV ZONE =====
let mvs = JSON.parse(localStorage.getItem("mvs")) || [];

// ===== SISTEMA AUTOM√ÅTICO =====

// adicionar novos MVs do Label automaticamente
labels.forEach(post=>{

    let existe = mvs.find(m=>m.labelID === post.id);

    if(!existe){
        mvs.push({
            id: Date.now()+Math.random(),
            labelID: post.id,
            group: post.group,
            company: post.company,
            url: post.url,
            likes:0,
            dislikes:0,
            score:0,
            comments:[],
            votes:{},
            data: Date.now()
        });
    }
});

// remover ap√≥s 30 dias
let agora = Date.now();
mvs = mvs.filter(m=> agora - m.data < 30*24*60*60*1000);

// recalcular pontua√ß√£o
mvs.forEach(m=>{
    m.score = (m.likes*5) - (m.dislikes*5);
});

// ordenar ranking autom√°tico
mvs.sort((a,b)=> b.score - a.score);

// limitar top 100
mvs = mvs.slice(0,100);

// salvar banco atualizado
localStorage.setItem("mvs", JSON.stringify(mvs));

// ===== RENDER =====
let area = document.getElementById("area");

mvs.forEach((mv,index)=>{

    let videoID = mv.url.split("v=")[1]?.split("&")[0] || mv.url.split("youtu.be/")[1];

    let div = document.createElement("div");
    div.className="mv";

    div.innerHTML=`
        <h3>#${index+1} ‚Ä¢ ${mv.group}</h3>
        <div class="info">${mv.company}</div>

        <iframe src="https://www.youtube.com/embed/${videoID}" allowfullscreen></iframe>

        <div class="score">
            Pontos: ${mv.score} | üëç ${mv.likes} | üëé ${mv.dislikes}
        </div>

        <div class="actions">
            <img src="like.png" onclick="vote('${mv.id}',1)">
            <img src="deslike.png" onclick="vote('${mv.id}',-1)">
        </div>

        <small style="color:#aaa;">
        Seja criativo! Ex: "A coreografia ficou incr√≠vel", 
        "O membro X brilhou", "Melhor comeback do ano!"
        </small>

        <input class="comment-box" id="c${mv.id}" placeholder="Comentar...">
        <button onclick="comment('${mv.id}')">Enviar</button>

        <div id="comments${mv.id}"></div>
    `;

    area.appendChild(div);
    renderComments(mv.id);
});

// ===== VOTA√á√ÉO =====
function vote(id,type){

    let mvs = JSON.parse(localStorage.getItem("mvs"));
    let mv = mvs.find(m=>m.id==id);

    let uid = user.id || user.nome;

    if(mv.votes[uid]){
        if(mv.votes[uid]==1){mv.likes--;}
        if(mv.votes[uid]==-1){mv.dislikes--;}
        delete mv.votes[uid];
    }else{
        mv.votes[uid]=type;
        if(type==1){mv.likes++;}
        if(type==-1){mv.dislikes++;}
    }

    localStorage.setItem("mvs", JSON.stringify(mvs));
    location.reload();
}

// ===== COMENTAR =====
function comment(id){

    let texto = document.getElementById("c"+id).value;
    if(!texto) return;

    let mvs = JSON.parse(localStorage.getItem("mvs"));
    let mv = mvs.find(m=>m.id==id);

    mv.comments.push({
        cid:Date.now(),
        user:user.nome,
        text:texto
    });

    localStorage.setItem("mvs", JSON.stringify(mvs));
    location.reload();
}

// ===== RENDER COMMENTS =====
function renderComments(id){

    let mvs = JSON.parse(localStorage.getItem("mvs"));
    let mv = mvs.find(m=>m.id==id);
    let box = document.getElementById("comments"+id);

    mv.comments.forEach(c=>{
        let d=document.createElement("div");
        d.className="comment";
        d.innerHTML=`
        <b>${c.user}</b>: ${c.text}
        ${c.user===user.nome ? `<span class="delete" onclick="del('${id}','${c.cid}')"> apagar</span>`:""}
        `;
        box.appendChild(d);
    });
}

function del(id,cid){

    let mvs = JSON.parse(localStorage.getItem("mvs"));
    let mv = mvs.find(m=>m.id==id);

    mv.comments = mv.comments.filter(c=>c.cid!=cid);

    localStorage.setItem("mvs", JSON.stringify(mvs));
    location.reload();
}

</script>
</body>
</html>
