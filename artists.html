<!DOCTYPE html><html>
<head>
<meta charset="UTF-8">
<title>R-Net Artists</title><!-- Firebase --><script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script><script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script><style>
body{
    font-family: Arial;
    background:#111;
    color:white;
    text-align:center;
}

#loginArea, #empresaArea{
    margin:20px;
}

input{
    padding:8px;
    margin:5px;
}

button{
    padding:8px 15px;
    cursor:pointer;
}

.artistCard{
    border:4px solid gold;
    border-radius:10px;
    margin:20px auto;
    padding:15px;
    max-width:350px;
    background:#1b1b1b;
}

.artistCard img{
    width:100%;
    height:auto;
    object-fit:contain;
}

.likeBtn{
    margin:5px;
    cursor:pointer;
}

#confetti{
    position:fixed;
    top:0;
    left:0;
    width:100%;
    pointer-events:none;
}
</style></head>
<body><h1>R-Net Artists</h1><p><b>Aprecie todos os grupos aqui!</b></p>
<p>Apenas empresas podem cadastrar artistas. Voc√™ pode entrar como visitante ou empresa.</p><div id="loginArea">
    <h3>Login Empresa</h3>
    <input id="empresaNome" placeholder="Nome da empresa">
    <input id="empresaSenha" type="password" placeholder="Senha">
    <button onclick="loginEmpresa()">Entrar</button><h3>Cadastrar nova empresa</h3>
<input id="newEmpresaNome" placeholder="Nome">
<input id="newEmpresaSenha" type="password" placeholder="Senha">
<button onclick="cadastrarEmpresa()">Cadastrar empresa</button>

</div><div id="empresaArea" style="display:none;">
    <h2>Painel da Empresa</h2>
    <input id="artNome" placeholder="Nome do artista ou grupo">
    <input id="artTipo" placeholder="Grupo ou Solista">
    <input id="artImagem" placeholder="URL da imagem">
    <button onclick="cadastrarArtista()">Cadastrar Artista</button>
</div><h2>Artistas</h2>
<div id="artistsArea"></div><canvas id="confetti"></canvas>

<script>
// CONFIG
firebase.initializeApp({
  apiKey: "AIzaSyAtv9gmTCvlor0zkdLzqWQbheeahr2xy9U",
  authDomain: "rnet-artist.firebaseapp.com",
  projectId: "rnet-artist",
  storageBucket: "rnet-artist.firebasestorage.app",
  messagingSenderId: "177874343578",
  appId: "1:177874343578:web:00936bd86e08ff2c6d3123"
});

const db = firebase.firestore();
let empresaLogada = null;

// CONFETE SIMPLES
const canvas = document.getElementById("confetti");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = 200;
for(let i=0;i<100;i++){
    ctx.fillStyle = "hsl("+Math.random()*360+",100%,50%)";
    ctx.fillRect(Math.random()*canvas.width, Math.random()*200, 5,5);
}

// CADASTRAR EMPRESA
function cadastrarEmpresa(){
    const nome = document.getElementById("newEmpresaNome").value.trim();
    const senha = document.getElementById("newEmpresaSenha").value.trim();

    if(!nome || !senha){
        alert("Preencha tudo");
        return;
    }

    db.collection("companies").doc(nome).set({
        senha: senha
    }).then(()=>{
        alert("Empresa cadastrada!");
    });
}

// LOGIN
function loginEmpresa(){
    const nome = document.getElementById("empresaNome").value.trim();
    const senha = document.getElementById("empresaSenha").value.trim();

    db.collection("companies").doc(nome).get().then(doc=>{
        if(doc.exists && doc.data().senha === senha){
            empresaLogada = nome;
            document.getElementById("empresaArea").style.display="block";
            alert("Login realizado!");
        }else{
            alert("Empresa ou senha incorreta");
        }
    });
}

// CADASTRAR ARTISTA (BUG CORRIGIDO)
function cadastrarArtista(){
    if(!empresaLogada){
        alert("Fa√ßa login como empresa");
        return;
    }

    const nome = document.getElementById("artNome").value.trim();
    const tipo = document.getElementById("artTipo").value.trim();
    const imagem = document.getElementById("artImagem").value.trim();

    if(!nome || !tipo || !imagem){
        alert("Preencha todos os campos");
        return;
    }

    db.collection("artist").add({
        nome: nome,
        tipo: tipo,
        imagem: imagem,
        likes: 0,
        dislikes: 0,
        owner: empresaLogada,
        createdAt: new Date()
    })
    .then(()=>{
        alert("Artista publicado!");
        carregarArtistas();
    })
    .catch(e=>{
        console.error(e);
        alert("Erro ao salvar artista");
    });
}

// CARREGAR ARTISTAS
function carregarArtistas(){
    const area = document.getElementById("artistsArea");
    area.innerHTML="";

    db.collection("artist").orderBy("createdAt","desc").get().then(snapshot=>{
        snapshot.forEach(doc=>{
            const a = doc.data();

            let excluirBtn = "";
            if(empresaLogada === a.owner){
                excluirBtn = `<button onclick="excluirArtista('${doc.id}')">Excluir</button>`;
            }

            area.innerHTML += `
                <div class="artistCard">
                    <img src="${a.imagem}">
                    <h3>${a.nome}</h3>
                    <p>${a.tipo}</p>
                    <p>üëç ${a.likes} | üëé ${a.dislikes}</p>
                    <button onclick="like('${doc.id}', ${a.likes})">Like</button>
                    <button onclick="dislike('${doc.id}', ${a.dislikes})">Dislike</button>
                    ${excluirBtn}
                </div>
            `;
        });
    });
}

// LIKE
function like(id, likes){
    db.collection("artist").doc(id).update({
        likes: likes + 1
    }).then(carregarArtistas);
}

// DISLIKE
function dislike(id, dislikes){
    db.collection("artist").doc(id).update({
        dislikes: dislikes + 1
    }).then(carregarArtistas);
}

// EXCLUIR
function excluirArtista(id){
    db.collection("artist").doc(id).delete().then(()=>{
        carregarArtistas();
    });
}

// INICIAR
carregarArtistas();
</script></body>
</html>
