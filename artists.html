<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>R-Net Artists</title>

<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>

<style>
body{
    font-family: Arial;
    background:#111;
    color:white;
    text-align:center;
    margin:0;
}

header{
    background:black;
    padding:20px;
    font-size:28px;
    font-weight:bold;
    color:gold;
}

#warning{
    background:#222;
    padding:10px;
    font-size:14px;
}

#loginArea{
    margin:30px;
}

input, button{
    padding:10px;
    margin:5px;
    border-radius:6px;
    border:none;
}

button{
    background:gold;
    font-weight:bold;
    cursor:pointer;
}

#adminPanel{
    display:none;
    margin:20px;
    background:#222;
    padding:20px;
    border-radius:10px;
}

#artists{
    display:flex;
    flex-wrap:wrap;
    justify-content:center;
    gap:20px;
    padding:20px;
}

.card{
    background:#1a1a1a;
    border:3px solid gold;
    border-radius:15px;
    width:260px;
    padding:15px;
}

.card img{
    width:100%;
    height:auto;
    border-radius:10px;
}

.name{
    font-size:20px;
    font-weight:bold;
    margin-top:10px;
}

.info{
    font-size:14px;
    margin:3px 0;
}

.reactions{
    margin-top:10px;
}

.reactions img{
    width:28px;
    cursor:pointer;
    margin:5px;
}

.deleteBtn{
    background:red;
    color:white;
    margin-top:10px;
}

#confetti{
    position:fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    pointer-events:none;
}
</style>
</head>
<body>

<header>R-Net Artists</header>

<div id="warning">
Aprecie todos os grupos aqui
</div>

<div id="loginArea">
<input id="code" placeholder="Código da empresa">
<br>
<button onclick="enterAdmin()">Entrar como Empresa</button>
<button onclick="enterVisitor()">Entrar como Visitante</button>
</div>

<div id="adminPanel">
<h3>Cadastrar Artista</h3>
<input id="name" placeholder="Nome"><br>
<input id="type" placeholder="Grupo ou Solista"><br>
<input id="company" placeholder="Empresa"><br>
<input id="debut" placeholder="Ano de debut"><br>
<input id="debutSong" placeholder="Música de debut"><br>
<input id="tiktok" placeholder="@tiktok"><br>
<input id="image" placeholder="URL da imagem"><br>
<button onclick="addArtist()">Cadastrar</button>
</div>

<div id="artists"></div>

<canvas id="confetti"></canvas>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyAtv9gmTCvlor0zkdLzqWQbheeahr2xy9U",
  authDomain: "rnet-artist.firebaseapp.com",
  projectId: "rnet-artist",
  storageBucket: "rnet-artist.firebasestorage.app",
  messagingSenderId: "177874343578",
  appId: "1:177874343578:web:00936bd86e08ff2c6d3123"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const ADMIN_CODE = "CgNIRHK6AOerilZ0Vcem8PWMe992";
let currentUser = "visitor";

// LOGIN
function enterAdmin(){
    const code = document.getElementById("code").value;
    if(code === ADMIN_CODE){
        currentUser = code;
        document.getElementById("adminPanel").style.display="block";
        document.getElementById("loginArea").style.display="none";
        loadArtists();
        confettiEffect();
    }else{
        alert("Código inválido");
    }
}

function enterVisitor(){
    currentUser = "visitor";
    document.getElementById("loginArea").style.display="none";
    loadArtists();
    confettiEffect();
}

// CADASTRAR
function addArtist(){
    db.collection("artist").add({
        name: name.value,
        type: type.value,
        company: company.value,
        debut: debut.value,
        debutSong: debutSong.value,
        tiktok: tiktok.value,
        image: image.value,
        likes: 0,
        dislikes: 0,
        owner: ADMIN_CODE,
        createdAt: new Date()
    });
}

// LISTAR
function loadArtists(){
    db.collection("artist").orderBy("createdAt","desc")
    .onSnapshot(snapshot=>{
        artists.innerHTML="";
        snapshot.forEach(doc=>{
            const a = doc.data();

            let deleteButton = "";
            if(currentUser === a.owner){
                deleteButton = `<button class="deleteBtn" onclick="deleteArtist('${doc.id}')">Excluir</button>`;
            }

            artists.innerHTML += `
            <div class="card">
                <img src="${a.image}">
                <div class="name">${a.name}</div>
                <div class="info">${a.type}</div>
                <div class="info">${a.company}</div>
                <div class="info">Debut: ${a.debut}</div>
                <div class="info">Song: ${a.debutSong}</div>
                <div class="info">${a.tiktok}</div>

                <div class="reactions">
                    <img src="like.png" onclick="like('${doc.id}', ${a.likes || 0})"> ${a.likes || 0}
                    <img src="deslike.png" onclick="dislike('${doc.id}', ${a.dislikes || 0})"> ${a.dislikes || 0}
                </div>

                ${deleteButton}
            </div>
            `;
        });
    });
}

// EXCLUIR
function deleteArtist(id){
    db.collection("artist").doc(id).delete();
}

// LIKE
function like(id, current){
    db.collection("artist").doc(id).update({
        likes: current + 1
    });
}

function dislike(id, current){
    db.collection("artist").doc(id).update({
        dislikes: current + 1
    });
}

// CONFETE
function confettiEffect(){
    const canvas = document.getElementById("confetti");
    const ctx = canvas.getContext("2d");
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    let pieces = [];
    for(let i=0;i<100;i++){
        pieces.push({
            x: Math.random()*canvas.width,
            y: Math.random()*canvas.height,
            r: Math.random()*6+4
        });
    }

    function draw(){
        ctx.clearRect(0,0,canvas.width,canvas.height);
        ctx.fillStyle="gold";
        pieces.forEach(p=>{
            ctx.beginPath();
            ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
            ctx.fill();
            p.y += 2;
            if(p.y > canvas.height) p.y = 0;
        });
        requestAnimationFrame(draw);
    }
    draw();
}
</script>

</body>
</html>
